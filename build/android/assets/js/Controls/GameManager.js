var gameManager=function(n){function e(){a=require("js/Models/Pieces"),i=require("js/Views/Piece"),i.setup(s),u=require("js/Views/Messages")}function r(n,e){return Math.ceil(Math.random()*e)+n}function o(){return Math.random()<.5}"Scenery"!=n.objType&&console.info("gameManager should receive a Scenery!");var a,i,u,t,c,s=n,l=s.getSize(),f=l*l,v=function(){t=new Array(l);for(var n=0;l>n;n++){t[n]=new Array(l);for(var e=0;l>e;e++)t[n][e]=null}c=new Array(l)},w=function(n){for(var e=1;n>=e;e++){var o=r(0,l-1),i=r(0,l-1);null!=t[o][i]?e--:t[o][i]=new a.coin}},d=function(n){var e=1;n=void 0==n?0:30,S(function(r,o,a){null!=a&&(!function(n,e,r,o){setTimeout(function(){r.build(i.print,{i:n,j:e},s)},o)}(r,o,a,e),e+=n)})},p=function(){var n=Math.ceil(f/10),e=Math.ceil((f-n)/2),r=f-n-e;v(),w(n);var i=e,u=r;S(function(n,e){return 0==i?void(t[n][e]=new a.sword):0==u?void(t[n][e]=new a.skull):void(null==t[n][e]&&(o()?(t[n][e]=new a.skull,i--):(t[n][e]=new a.sword,u--)))})},k=function(){var n=new u.win;n.addAction(function(){y()}),s.showMessage(n)},m=function(){var n=new u.lose;n.addAction(function(){y()}),s.showMessage(n)},h=function(){for(var n=0,e=0,r=0;l>r;r++)"sword"==c[r].pieceType?e++:n++;return e==l?(k(),!0):n==l?(m(),!0):!1},M=function(){if(d(0),!h()){var n=Math.ceil(f/20);w(n),S(function(n,e,r){null==r&&(t[n][e]=o()?new a.skull:new a.sword)}),d(30)}},g=function(){p(),d(30)},y=function(){j(),v(),g()},j=function(){S(function(n,e,r){null!=r&&r.remove(s),t[n][e]=null})},b=function(){s.addEvent("swipe",function(n){switch(n.direction){case"down":A();break;case"up":T();break;case"left":q();break;case"right":C()}})},T=function(){for(var n=null,e=0;l>e;e++){for(var r=0,o=0,u=l-1;u>=0;u--){var s=t[u][e];if(null!=s){switch(s.pieceType){case"skull":r++;break;case"sword":o++}0==u&&e==l-1&&(n=function(){j();for(var n=0;l>n;n++){var e=0;t[e][n]=c[n]}M()}),s.move(i.move,{i:0,j:e},n)}}c[e]=o>r?new a.sword:new a.skull}},A=function(){for(var n=null,e=0;l>e;e++){for(var r=0,o=0,u=0;l>u;u++){var s=t[u][e];if(null!=s){switch(s.pieceType){case"skull":r++;break;case"sword":o++}u==e&&e==l-1&&(n=function(){j();for(var n=0;l>n;n++){var e=l-1;t[e][n]=c[n]}M()}),s.move(i.move,{i:l-1,j:e},n)}}c[e]=o>r?new a.sword:new a.skull}},q=function(){for(var n=null,e=0;l>e;e++){for(var r=0,o=0,u=l-1;u>=0;u--){var s=t[e][u];if(null!=s){switch(s.pieceType){case"skull":r++;break;case"sword":o++}e==l-1&&0==u&&(n=function(){j();for(var n=0;l>n;n++){var e=0;t[n][e]=c[n]}M()}),s.move(i.move,{i:e,j:0},n)}}c[e]=o>r?new a.sword:new a.skull}},C=function(){for(var n=null,e=0;l>e;e++){for(var r=0,o=0,u=0;l>u;u++){var s=t[e][u];if(null!=s){switch(s.pieceType){case"skull":r++;break;case"sword":o++}e==l-1&&u==e&&(n=function(){j();for(var n=0;l>n;n++){var e=l-1;t[n][e]=c[n]}M()}),s.move(i.move,{i:e,j:l-1},n)}}c[e]=o>r?new a.sword:new a.skull}},S=function(n){for(var e=0;l>e;e++)for(var r=0;l>r;r++)n(e,r,t[e][r])};return e(),{objType:"Game Manager",startControls:b,startGame:g}};module.exports=gameManager;