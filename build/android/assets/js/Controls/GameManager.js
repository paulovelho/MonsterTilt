var gameManager=function(e){function n(){a=require("js/Models/Pieces.js"),s=require("js/Views/Piece.js"),s.setup(u),i=require("js/Views/Messages.js")}function r(e,n){return Math.ceil(Math.random()*n)+e}function o(){return Math.random()<.5}"Scenery"!=e.objType&&console.info("gameManager should receive a Scenery!");var a,s,i,c,t,u=e,l=u.getSize(),f=l*l,v=function(){c=new Array(l);for(var e=0;l>e;e++){c[e]=new Array(l);for(var n=0;l>n;n++)c[e][n]=null}t=new Array(l)},w=function(e){for(var n=1;e>=n;n++){var o=r(0,l-1),s=r(0,l-1);null!=c[o][s]?n--:c[o][s]=new a.coin}},d=function(){A(function(e,n,r){null!=r&&r.build(s.print,{i:e,j:n},u)})},k=function(){var e=Math.ceil(f/10),n=Math.ceil((f-e)/2),r=f-e-n;v(),w(e);var s=n,i=r;A(function(e,n){return 0==s?void(c[e][n]=new a.sword):0==i?void(c[e][n]=new a.skull):void(null==c[e][n]&&(o()?(c[e][n]=new a.skull,s--):(c[e][n]=new a.sword,i--)))})},p=function(){var e=new i.win;u.showMessage(e)},m=function(){var e=new i.lose;u.showMessage(e)},h=function(){for(var e=0,n=0,r=0;l>r;r++)"sword"==t[r].pieceType?n++:e++;return n==l?(p(),!0):e==l?(m(),!0):!1},j=function(){if(h())return void d();var e=Math.ceil(f/20);w(e),A(function(e,n,r){null==r&&(c[e][n]=o()?new a.skull:new a.sword)}),d()},y=function(){k(),d()},M=function(){A(function(e,n,r){c[e][n]=null,r.remove(u)})},b=function(){u.addEvent("swipe",function(e){switch(e.direction){case"down":T();break;case"up":g();break;case"left":C();break;case"right":q()}}),window.document.addEventListener("keydown",function(e){switch(e.keyCode){case 40:T();break;case 38:g();break;case 37:C();break;case 39:q()}})},g=function(){for(var e=null,n=0;l>n;n++){for(var r=0,o=0,i=l-1;i>=0;i--){var u=c[i][n];switch(u.pieceType){case"skull":r++;break;case"sword":o++}0==i&&n==l-1&&(e=function(){M();for(var e=0;l>e;e++){var n=0;c[n][e]=t[e]}j()}),u.move(s.move,{i:0,j:n},e)}t[n]=o>r?new a.sword:new a.skull}},T=function(){for(var e=null,n=0;l>n;n++){for(var r=0,o=0,i=0;l>i;i++){var u=c[i][n];switch(u.pieceType){case"skull":r++;break;case"sword":o++}i==n&&n==l-1&&(e=function(){M();for(var e=0;l>e;e++){var n=l-1;c[n][e]=t[e]}j()}),u.move(s.move,{i:l-1,j:n},e)}t[n]=o>r?new a.sword:new a.skull}},C=function(){for(var e=null,n=0;l>n;n++){for(var r=0,o=0,i=l-1;i>=0;i--){var u=c[n][i];switch(u.pieceType){case"skull":r++;break;case"sword":o++}n==l-1&&0==i&&(e=function(){M();for(var e=0;l>e;e++){var n=0;c[e][n]=t[e]}j()}),u.move(s.move,{i:n,j:0},e)}t[n]=o>r?new a.sword:new a.skull}},q=function(){for(var e=null,n=0;l>n;n++){for(var r=0,o=0,i=0;l>i;i++){var u=c[n][i];switch(u.pieceType){case"skull":r++;break;case"sword":o++}n==l-1&&i==n&&(e=function(){M();for(var e=0;l>e;e++){var n=l-1;c[e][n]=t[e]}j()}),u.move(s.move,{i:n,j:l-1},e)}t[n]=o>r?new a.sword:new a.skull}},A=function(e){for(var n=0;l>n;n++)for(var r=0;l>r;r++)e(n,r,c[n][r])};return n(),{objType:"Game Manager",startControls:b,startGame:y}};module.exports=gameManager;